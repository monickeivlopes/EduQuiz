<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Relat√≥rio Geral da Turma - EduQuiz</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='relatorio_geral.css') }}">
     <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    
</head>
<body>

    <!-- Header -->
    <header>
        <div class="logo">
            <img src="static/img/Logo.png" alt="Logo EduQuiz" />
            <span>EDUQUIZ</span>
        </div>
        <nav>
  <a href="{{ url_for('index_professor') }}" class="home-icon">
    <i class="bi bi-house"></i>
  </a>
    </nav>
    </header>

    <div class="container">
        <!-- P√°gina Header -->
        <div class="header">
            <h1>Relat√≥rio Geral da Turma</h1>
            <p>An√°lise completa do desempenho dos alunos</p>
        </div>

        <!-- Dashboard Stats -->
        <div class="dashboard-stats">
            <div class="stat-card">
                <h3>Total de Alunos</h3>
                <span class="stat-number">{{ alunos|length }}</span>
            </div>
            <div class="stat-card">
                <h3>M√©dia Geral de Acertos</h3>
                <span class="stat-number">{{ medias[0]|round(1) }}%</span>
            </div>
            <div class="stat-card">
                <h3>Tempo M√©dio por Quiz</h3>
                <span class="stat-number">{{ (medias[2]/60)|round(1) }} min</span>
            </div>
            <div class="stat-card">
                <h3>Taxa de Engajamento</h3>
                <span class="stat-number">
                    {% set alunos_com_quizzes = alunos|selectattr('3', 'gt', 0)|list %}
                    {% if alunos|length > 0 %}
                        {{ (alunos_com_quizzes|length / alunos|length * 100)|round(1) }}%
                    {% else %}
                        0%
                    {% endif %}
                </span>
            </div>
        </div>

        <!-- Controls -->
        <div class="controls">
            <div class="filters">
                <select id="filterCurso">
                    <option value="all">Todos os cursos</option>
                    <option value="info">Inform√°tica</option>
                    <option value="eletro">Eletrot√©cnica</option>
                    <option value="vestuario">Vestu√°rio</option>
                    <option value="textil">T√™xtil</option>
                </select>
                
                <select id="filterPerformance">
                    <option value="all">Todos os desempenhos</option>
                    <option value="90">Excelente (90%+)</option>
                    <option value="70">Bom (70-89%)</option>
                    <option value="50">Regular (50-69%)</option>
                    <option value="0">Baixo (&lt;50%)</option>
                </select>
                
                <input type="text" id="searchInput" placeholder="Buscar aluno...">
            </div>
        </div>

        <!-- Table -->
        <div class="table-container">
            <table id="studentsTable">
                <thead>
                    <tr>
                        <th data-column="0">Aluno</th>
                        <th data-column="1">Curso</th>
                        <th data-column="2">Total Quizzes</th>
                        <th data-column="3">M√©dia Acertos</th>
                        <th data-column="4">M√©dia Erros</th>
                        <th data-column="5">Tempo M√©dio</th>
                        <th>Desempenho</th>
                        <th>A√ß√µes</th>
                    </tr>
                </thead>
                <tbody>
                    {% for aluno in alunos %}
                    {% set performance = aluno[4] | float %}
                    <tr>
                        <td><strong>{{ aluno[1] }}</strong></td>
                        <td>{{ aluno[2] }}</td>
                        <td>{{ aluno[3] }}</td>
                        <td class="positive">{{ aluno[4] }}%</td>
                        <td class="negative">{{ aluno[5] }}%</td>
                        <td>{{ aluno[6] }}s</td>
                        <td>
                            <span class="performance-badge {% if performance >= 80 %}excellent{% elif performance >= 60 %}good{% else %}regular{% endif %}">
                                {% if performance >= 80 %}Excelente
                                {% elif performance >= 60 %}Bom
                                {% elif performance >= 40 %}Regular
                                {% else %}Baixo
                                {% endif %}
                            </span>
                        </td>
                        <td>
                            <a href="{{ url_for('relatorio_aluno', aluno_id=aluno[0]) }}" 
                               class="detalhes-link">
                                üëÅÔ∏è Detalhes
                            </a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <!-- Charts -->
        <div class="charts-row">
            <div class="chart-container">
                <h3>Top 10 Alunos por Acertos (√öltimas Tentativas)</h3>
                <canvas id="performanceChart" height="250"></canvas>
            </div>
            <div class="chart-container">
                <h3>M√©dia de Acertos por Curso</h3>
                <canvas id="courseChart" height="250"></canvas>
            </div>
        </div>

    </div> <!-- /.container -->

    <!-- Dados do Flask para JS -->
    <script>
        const Labels = {{ labels | tojson | safe }};
        const Data = {{ data | tojson | safe }};
        const CursosLabels = {{ cursos_labels | tojson | safe }};
        const CursosData = {{ cursos_data | tojson | safe }};
        const TotalAcertos = {{ acertos | default(0) }};
        const TotalErros = {{ erros | default(0) }};
    </script>

    <!-- Script externo -->
    <script src="{{ url_for('static', filename='js/relatorio_geral.js') }}"></script>

</body>
</html>
